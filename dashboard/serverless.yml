service: app

provider:
    name: aws
    region: eu-central-1
    runtime: provided
    environment:
        ACCESS_KEY_ID: ${ssm:s3_id}
        SECRET_ACCESS_KEY: ${ssm:s3_secret}
        APP_ENV: prod

custom:
    docsDomain:
        domainName: docs.dq.docplanner.io
        basePath: ''
        stage: ${self:provider.stage}
        createRoute53Record: true

package:
    exclude:
        - .git/*
        - .env.local

plugins:
    - ./vendor/bref/bref

functions:
    website:
        handler: public/index.php
        timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)
        layers:
            - ${bref:layer.php-73-fpm}
        events:
            - alb:
                  listenerArn: arn:aws:elasticloadbalancing:eu-central-1:996507694991:listener/app/lb-tenv/bd342adc00b541e6/480fc1b7c1cce2f2
                  priority: 3
                  conditions:
                      path: /
                      host: docs.dq.docplanner.io
